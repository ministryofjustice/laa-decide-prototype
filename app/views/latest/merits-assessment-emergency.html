{% extends "layouts/layout.html" %}

{% block pageTitle %}
Merits assessment - emergency
{% endblock %}

{% block beforeContent %}
<a class="govuk-back-link" href="application-details">Back to application details</a>
{% endblock %}

{% set application = data['application']['applicationDetails'] %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-xl govuk-!-margin-bottom-4">Make a merits decision</h1>
    <p class="govuk-!-font-size-36">{{ application['refNo'] }}</p>
    <div class="govuk-!-padding-top-4"></div>
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h2 class="govuk-heading-l govuk-!-margin-bottom-4">Emergency certificates</h1>
    <form action="merits-assessment-substantive" method="POST">


<div class="govuk-form-group">
        {% for proceeding in application['proceedings'] %}
        {% for certificate in proceeding['certificates'] %}
        {% if certificate['certificateType'] === 'Emergency certificate' %}

        {% set hint=application['categoryLaw'] + ' - ' + proceeding['matterType'] +  '<br>' + 'Form of service: ' + certificate['formOfService']  %}

        {% set refuseHtml %}
        {% include "./_refusal_reasons_dropdown.html" %}
        {% endset -%}

        {{ govukRadios({
          idPrefix: certificate['id']+"_decision",
          name: certificate['id'],
          fieldset: {
            legend: {
              text: proceeding['proceedingType'],
              classes: "govuk-fieldset__legend--m"
            }
          },
          hint: {
            text: hint | safe
          },
          items: [
            {
              value: "granted",
              text: "Grant",
              checked: checked(certificate['id'], "granted")
            },
            {
              value: "amended",
              text: "Change to default scope and grant",
              checked: checked(certificate['id'], "amended")
            },
            {
              value: "refused",
              text: "Refuse",
              checked: checked(certificate['id'], "refused"),
              conditional: {
                html: refuseHtml
              }
            }
          ]
        })}}


          <h1 class="govuk-label-wrapper">
            <label class="govuk-label govuk-label--m" for="granted-emergency">
              How much should be granted for the emergency certificate?
            </label>
          </h1>

        <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible">
        {% endif %}
        {% endfor %}
        {% endfor %}

        <div class="govuk-button-group">
          <input type="submit" name="merits_continue_button" value="Save and continue" id="continue" class="govuk-button form-button" data-module="govuk-button" data-disable-with="Save and continue">
          <input type="submit" name="merits_continue_button" value="Save and come back later" id="continue" class="govuk-button form-button govuk-button--secondary govuk-!-margin-left-3" data-module="govuk-button"
            data-disable-with="Save and come back later">
        </div>

    </form>
  </div>
</div>
{% endblock %}